From 312a63546fd7c84ede18d57de5cc163405b2e346 Mon Sep 17 00:00:00 2001
From: Hendrik Borghorst <hendrikborghorst@gmail.com>
Date: Sun, 26 Jan 2025 13:53:23 +0100
Subject: [PATCH] rg28xx: Update DTS for generic panel driver

---
 arch/arm64/boot/dts/allwinner/Makefile        |  2 +-
 .../allwinner/sun50i-h700-anbernic-rg28xx.dts | 75 +++++++++++++++++++
 2 files changed, 76 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/allwinner/sun50i-h700-anbernic-rg28xx.dts

diff --git a/arch/arm64/boot/dts/allwinner/Makefile b/arch/arm64/boot/dts/allwinner/Makefile
index 00bed412ee31..f7eb13afd2aa 100644
--- a/arch/arm64/boot/dts/allwinner/Makefile
+++ b/arch/arm64/boot/dts/allwinner/Makefile
@@ -49,6 +49,6 @@ dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-orangepi-zero2w.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-orangepi-zero3.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h618-transpeed-8k618-t.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h700-anbernic-rg35xx-2024.dtb
-dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h700-anbernic-rg35xx-h.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h700-anbernic-rg35xx-plus.dtb
 dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h700-anbernic-rg35xx-sp.dtb
+dtb-$(CONFIG_ARCH_SUNXI) += sun50i-h700-anbernic-rg28xx.dtb
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h700-anbernic-rg28xx.dts b/arch/arm64/boot/dts/allwinner/sun50i-h700-anbernic-rg28xx.dts
new file mode 100644
index 000000000000..36a0347b1017
--- /dev/null
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h700-anbernic-rg28xx.dts
@@ -0,0 +1,75 @@
+// SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
+/*
+ * Copyright (C) 2024 Ryan Walklin <ryan@testtoast.com>.
+ * Copyright (C) 2024 Chris Morgan <macroalpha82@gmail.com>.
+ */
+
+#include <dt-bindings/input/gpio-keys.h>
+#include "sun50i-h700-anbernic-rg35xx-plus.dts"
+
+/ {
+	model = "Anbernic RG28XX";
+	compatible = "anbernic,rg28xx", "allwinner,sun50i-h700";
+};
+
+&panel {
+	compatible = "panel-mipi-dpi-spi";
+
+	power-supply = <&reg_lcd>;
+	io-supply = <&reg_lcd>;
+	reset-gpios = <&pio 8 14 GPIO_ACTIVE_LOW>; /* LCD-RST: PI14 */
+
+	width-mm = <44>;
+	height-mm = <58>;
+	rotation = <270>;
+
+	reset-delay = <1>;
+	init-delay = <10>;
+	sleep-delay = <120>;
+	backlight-delay = <120>;
+
+	init-sequence = [
+		06 ff 77 01 00 00 13 02 ef 08 06 ff 77 01 00 00
+		10 03 c0 4f 00 03 c1 10 02 03 c2 37 02 04 c3 00
+		10 02 02 c7 04 02 cc 10 11 b0 00 10 17 0d 11 06
+		05 08 07 1f 04 11 0e 29 30 1f 11 b1 00 0d 14 0e
+		11 06 04 08 08 20 05 13 13 26 30 1f 06 ff 77 01
+		00 00 11 02 b0 65 02 b1 71 02 b2 87 02 b3 80 02
+		b5 4d 02 b7 85 02 b8 20 02 c1 78 02 c2 78 02 d0
+		88 02 ee 42 04 e0 00 00 02 0c e1 04 a0 06 a0 05
+		a0 07 a0 00 44 44 0d e2 00 00 00 00 00 00 00 00
+		00 00 00 00 05 e3 00 00 22 22 03 e4 44 44 11 e5
+		0c 90 a0 a0 0e 92 a0 a0 08 8c a0 a0 0a 8e a0 a0
+		05 e6 00 00 22 22 03 e7 44 44 11 e8 0d 91 a0 a0
+		0f 93 a0 a0 09 8d a0 a0 0b 8f a0 a0 08 eb 00 00
+		e4 e4 44 00 40 11 ed ff f5 47 6f 0b a1 ba ff ff
+		ab 1a b0 f6 74 5f ff 07 ef 08 08 08 45 3f 54 06
+		ff 77 01 00 00 13 02 e6 16 03 e8 00 0e 06 ff 77
+		01 00 00 00 02 36 10 01 11 80 00 00 06 ff 77 01
+		00 00 13 03 e8 00 0c 00 03 e8 00 00 06 ff 77 01
+		00 00 00
+	];
+
+	display-timings {
+		native-mode = <&timing0>;
+
+		timing0: timing@0 {
+			clock-frequency = <27000000>;
+
+			hactive = <480>;
+			hfront-porch = <70>;
+			hsync-len = <5>;
+			hback-porch = <70>;
+
+			vactive = <640>;
+			vfront-porch = <40>;
+			vsync-len = <4>;
+			vback-porch = <36>;
+
+			vsync-active = <0>;
+			hsync-active = <0>;
+			de-active = <1>;
+			pixelclk-active = <0>;
+		};
+	};
+};
-- 
2.45.3

