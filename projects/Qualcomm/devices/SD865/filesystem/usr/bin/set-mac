#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2024-present ROCKNIX (https://github.com/ROCKNIX)

# Read SoC serial
MAC="$(md5sum /sys/devices/soc0/serial_number)"

case "$1" in
  wifi)
    WLAN_MAC="$(echo 00:03:7F:${MAC:0:2}:${MAC:2:2}:${MAC:4:2})"
    ip link set wlan0 down
    ip link set wlan0 address "${WLAN_MAC}"
    ip link set wlan0 up
    ;;
  bluetooth)
    BT_MAC="$(echo 00:03:7F:${MAC:4:2}:${MAC:2:2}:${MAC:0:2})"
    sleep 5 # dont set mac immediately after modprobe
    bluetoothctl mgmt.public-addr "${BT_MAC}"
    ;;
esac
